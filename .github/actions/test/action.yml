# Inspired by https://github.com/utopia-rise/fmod-gdextension/blob/godot-3.x/demo/run_tests.sh

name: test
description: "Runs the tests via GUT CLI"

inputs:
  godot-test-project:
    required: true
    default: ${{ github.workspace }}/test

runs:
  using: composite

  steps:
    - name: "⚔ Link Mod Loader"
      shell: bash
      run: ln -s ${{ github.workspace }}/addons/mod_loader ${{ github.workspace }}/test/addons/mod_loader

    - name: "⚔ Link JSON_Schema_Validator"
      shell: bash
      run: ln -s ${{ github.workspace }}/addons/JSON_Schema_Validator ${{ github.workspace }}/test/addons/JSON_Schema_Validator

    - name: "Run Tests"
      if: ${{ runner.OS == 'Linux' }}
      env:
        TEST_PROJECT: ${{ inputs.godot-test-project }}
      shell: bash
      run: |
        cd "${TEST_PROJECT}"
        chmod +x run_tests.sh
        ./run_tests.sh $HOME/godot-linux/godot
